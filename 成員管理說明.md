# 成員管理功能說明

## 功能概述

現在您的共同記帳系統已經支援完整的成員管理功能，包括：
- ✅ Google 帳號自動登入
- ✅ 顯示用戶頭像和資訊
- ✅ 邀請新成員加入
- ✅ 自動發送邀請郵件
- ✅ 查看所有成員列表
- ✅ 移除成員
- ✅ 管理員權限控制

---

## 使用說明

### 1️⃣ 首次部署設定

#### 步驟 1：啟用 People API
1. 在 Google Apps Script 編輯器中
2. 點擊左側的「服務」（Services）或「➕」圖示
3. 搜尋並添加「Google People API」
4. 版本選擇 `v1`
5. 點擊「新增」

#### 步驟 2：部署為 Web 應用
1. 點擊右上角「部署」→「新部署」
2. 類型選擇「網頁應用」
3. 設定：
   - **執行身份**：選擇「我」
   - **具有訪問權限的用戶**：選擇「任何人」（系統會自動檢查權限）
4. 點擊「部署」
5. 複製部署的 URL

#### 步驟 3：授權
- 首次部署時會要求授權
- 需要授權以下權限：
  - 訪問 Google 試算表
  - 訪問個人資料（顯示頭像）
  - 發送電子郵件（邀請成員）

---

### 2️⃣ 成員管理操作

#### 📧 邀請新成員

1. 登入後，點擊右上角的「**成員**」按鈕
2. 在「邀請新成員」區域輸入對方的 **Gmail 地址**
3. 點擊「**發送邀請**」

**系統會自動：**
- ✅ 將該 Email 加入允許清單
- ✅ 發送一封邀請郵件給對方
- ✅ 郵件中包含應用連結

**受邀者操作：**
1. 打開邀請郵件
2. 點擊郵件中的「開始使用」按鈕
3. 使用受邀的 Google 帳號登入
4. 即可開始使用記帳系統

#### 👥 查看成員列表

1. 點擊「**成員**」按鈕
2. 可以看到所有成員：
   - **管理員**：顯示藍色標記，無法被移除
   - **普通成員**：可以被管理員移除

#### 🗑️ 移除成員

**⚠️ 只有管理員（試算表擁有者）可以移除成員**

1. 點擊「**成員**」按鈕
2. 在想要移除的成員旁邊點擊「**移除**」
3. 確認後即可移除

**注意事項：**
- 管理員無法移除自己
- 被移除的成員將無法再訪問系統

---

### 3️⃣ 權限說明

#### 管理員（擁有者）
- 試算表的擁有者自動成為管理員
- 可以邀請新成員
- 可以移除成員
- 可以查看和管理所有數據

#### 普通成員
- 受邀加入的成員
- 可以新增支出記錄
- 可以查看所有記錄
- 可以使用所有記帳功能
- 無法邀請或移除其他成員

---

## 功能特色

### 🎨 美觀的界面
- 圓形頭像顯示
- 懸停動畫效果
- 管理員標記
- 響應式設計（支援手機）

### 📧 自動郵件通知
邀請郵件包含：
- 友善的歡迎訊息
- 一鍵加入按鈕
- 應用程式連結
- 邀請者資訊

### 🔒 安全性
- 基於 Google 帳號認證
- 白名單機制
- 只有允許的使用者可以訪問
- 管理員專屬操作

### 📱 移動端優化
- 小屏幕自動隱藏用戶名
- 保留頭像和郵箱顯示
- 觸控友好的按鈕

---

## 常見問題

### Q1: 受邀者收不到郵件怎麼辦？
**方法 1：檢查垃圾郵件**
- 請受邀者檢查垃圾郵件資料夾

**方法 2：直接分享連結**
1. 在 Google Apps Script 中
2. 點擊選單「📊 記帳系統」→「📱 開啟網頁版」
3. 複製連結直接傳送給對方

**方法 3：手動添加**
1. 打開 Google 試算表
2. 進入「設定」工作表
3. 在「允許存取的使用者」欄位手動添加 Email
4. 多個使用者用逗號分隔：`user1@gmail.com, user2@gmail.com`

### Q2: 如何變更管理員？
目前管理員是試算表的擁有者，無法變更。如需變更：
1. 在 Google 試算表中
2. 點擊「共用」
3. 將試算表的擁有權轉移給其他人

### Q3: 成員可以看到所有記錄嗎？
是的，所有成員都可以看到所有支出記錄。這是設計給情侶或家人共同記帳使用的。

### Q4: 受邀者必須使用 Gmail 嗎？
是的，必須使用 Google 帳號（Gmail 或 Google Workspace）才能登入。

### Q5: 可以設定多個管理員嗎？
目前只有試算表擁有者是管理員。其他成員都是普通成員。

---

## 技術細節

### 使用的 API
- **Google People API**：獲取用戶頭像
- **MailApp**：發送邀請郵件
- **Session**：獲取當前用戶資訊

### 數據儲存
成員列表儲存在「設定」工作表的 B6 儲存格中，格式為逗號分隔的 Email 清單。

### 安全機制
每次訪問時都會檢查 `Session.getActiveUser().getEmail()` 是否在允許清單中。

---

## 更新日誌

### v2.0 - 2024
- ✅ 新增 Google 帳號自動登入
- ✅ 顯示用戶頭像和資訊
- ✅ 成員管理功能
- ✅ 邀請郵件自動發送
- ✅ 管理員權限控制
- ✅ 移動端界面優化

---

## 支援

如有問題或建議，請聯繫系統管理員（試算表擁有者）。
