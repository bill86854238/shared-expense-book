# 🚀 新增功能說明

## ✨ 剛剛新增的 5 大功能

---

## 1️⃣ 搜尋功能 🔍

### 功能說明：
即時搜尋支出項目，輸入關鍵字立即篩選。

### 使用方式：
```
在「🔍 搜尋項目...」輸入框輸入關鍵字
例如：「晚餐」「房租」「電影」
```

### 特色：
- ✅ **即時搜尋**：不用按Enter，打字即時篩選
- ✅ **大小寫不敏感**：「dinner」和「DINNER」都能搜到
- ✅ **部分比對**：輸入「餐」能找到「晚餐」「午餐」

### 範例：
```
輸入「餐」→ 顯示：晚餐、午餐、早餐
輸入「租」→ 顯示：房租、租車
```

---

## 2️⃣ 多維度篩選 📊

### 功能說明：
可以同時用多個條件篩選記錄。

### 篩選選項：

#### 1. **分類篩選**
```
全部分類
🍜 飲食
🏠 居住
🚗 交通
🎮 娛樂
📦 其他
```

#### 2. **付款人篩選**
```
全部付款人
你付的
對方付的
共同付的
```

#### 3. **日期範圍**
```
開始日期：2024-01-01
結束日期：2024-01-31
```

### 使用方式：
1. 選擇篩選條件
2. 點選「篩選」按鈕
3. 點選「清除」恢復顯示全部

### 特色：
- ✅ **多條件組合**：可同時選擇分類+付款人+日期
- ✅ **即時統計**：篩選後顯示符合條件的記錄數量
- ✅ **智慧篩選**：空值表示「全部」

### 實際應用：

#### 範例 1：查看這個月的飲食開銷
```
分類：🍜 飲食
開始日期：2024-01-01
結束日期：2024-01-31
→ 點選「篩選」
```

#### 範例 2：查看對方付的所有居住費用
```
分類：🏠 居住
付款人：對方付的
→ 點選「篩選」
```

#### 範例 3：查看上週的所有支出
```
開始日期：2024-01-08
結束日期：2024-01-14
→ 點選「篩選」
```

---

## 3️⃣ 刪除記錄 🗑️

### 功能說明：
可以刪除記錯的記錄。

### 使用方式：
1. 在記錄列表找到要刪除的項目
2. 點選右側紅色「刪除」按鈕
3. 確認後即可刪除

### 特色：
- ✅ **確認機制**：刪除前會跳出確認對話框，防止誤刪
- ✅ **即時更新**：刪除後統計數字立即更新
- ✅ **Toast 通知**：刪除成功會顯示「刪除成功！」

### 安全機制：
```javascript
if (!confirm('確定要刪除這筆記錄嗎？')) {
  return; // 取消就不會刪除
}
```

### 注意事項：
- ⚠️ **無法復原**：刪除後無法還原，請謹慎使用
- 💡 **建議**：刪除前先確認是否正確

---

## 4️⃣ 圖表視覺化 📊

### 功能說明：
用漂亮的長條圖顯示支出統計。

### 使用方式：
1. 點選右上角綠色「📊 圖表」按鈕
2. 在彈出視窗查看圖表
3. 點選「×」或視窗外部關閉

### 圖表類型：

#### 1. **分類支出統計**
顯示每個分類的總支出金額，按比例顯示長條圖。

```
🍜 飲食   ████████████████████ $15,000
🏠 居住   ████████████████ $12,000
🚗 交通   ████████ $6,000
🎮 娛樂   ████ $3,000
📦 其他   ██ $1,500
```

#### 2. **付款人統計**
顯示你、對方、兩人各付了多少錢。

```
你     ████████████████████ $20,000
對方   ██████████████ $10,500
兩人   ██████ $7,000
```

### 特色：
- ✅ **動畫效果**：長條圖從左到右展開
- ✅ **漸層配色**：紫色漸層，美觀專業
- ✅ **響應式設計**：手機、電腦都適合查看
- ✅ **動態計算**：根據篩選結果即時更新

### 實際應用：

#### 範例 1：查看這個月各分類花費比例
```
1. 設定日期範圍：2024-01-01 ~ 2024-01-31
2. 點選「篩選」
3. 點選「📊 圖表」
→ 一眼看出哪個分類花最多錢
```

#### 範例 2：查看誰付得比較多
```
點選「📊 圖表」
→ 看「付款人統計」
→ 長條圖長度代表金額大小
```

---

## 5️⃣ 匯出 CSV 💾

### 功能說明：
將記錄匯出成 Excel 可開啟的 CSV 檔案。

### 使用方式：
1. 篩選出想要匯出的記錄（可選）
2. 點選右上角橘色「💾 匯出」按鈕
3. 檔案自動下載

### 匯出內容：
```csv
日期,項目,金額,付款人,你的部分,對方的部分,分類
2024-01-15,晚餐,600,兩人,300,300,飲食
2024-01-16,電影票,480,你,480,0,娛樂
2024-01-17,超市,1200,對方,0,1200,飲食
```

### 檔案格式：
- **檔名格式**：`支出記錄_2024-01-20.csv`
- **編碼**：UTF-8（中文不會亂碼）
- **可用軟體開啟**：Excel、Numbers、Google Sheets

### 特色：
- ✅ **中文相容**：使用 UTF-8 BOM，Excel 可正確顯示中文
- ✅ **智慧匯出**：只匯出篩選後的結果
- ✅ **自動命名**：檔名包含匯出日期

### 實際應用：

#### 範例 1：匯出這個月的記錄給對方看
```
1. 設定日期：2024-01-01 ~ 2024-01-31
2. 點選「篩選」
3. 點選「💾 匯出」
→ 將檔案傳給對方
```

#### 範例 2：匯出全年記錄備份
```
1. 設定日期：2024-01-01 ~ 2024-12-31
2. 點選「篩選」
3. 點選「💾 匯出」
→ 存檔備份
```

#### 範例 3：匯出特定分類
```
1. 選擇分類：🍜 飲食
2. 點選「篩選」
3. 點選「💾 匯出」
→ 只匯出飲食類記錄
```

### 用 Excel 開啟後可以：
- 製作更複雜的圖表（圓餅圖、折線圖）
- 用樞紐分析表分析
- 列印紙本報表
- 進一步加工計算

---

## 🎯 功能組合應用

### 情境 1：月底結算
```
1. 日期篩選：選擇這個月
2. 點選「📊 圖表」查看整體花費
3. 點選「💾 匯出」備份記錄
4. 用 Excel 列印給對方確認
```

### 情境 2：檢討飲食開銷
```
1. 分類：選擇「🍜 飲食」
2. 日期：選擇這個月
3. 點選「篩選」
4. 查看記錄數量
5. 點選「📊 圖表」看付款比例
→ 決定下個月是否要控制飲食預算
```

### 情境 3：查看對方貢獻
```
1. 付款人：選擇「對方付的」
2. 點選「篩選」
3. 統計卡片會顯示對方總共付了多少
4. 點選「📊 圖表」看各分類分布
```

### 情境 4：刪除錯誤記錄
```
1. 搜尋框輸入記錄關鍵字
2. 找到錯誤的記錄
3. 點選「刪除」
4. 確認刪除
→ 統計立即更新
```

### 情境 5：季度分析
```
1. 日期：設定 1/1 ~ 3/31（第一季）
2. 點選「篩選」
3. 點選「📊 圖表」查看
4. 點選「💾 匯出」備份
5. 用 Excel 做更詳細的分析
```

---

## 📱 介面改進

### 記錄數量顯示：
```
共 45 筆記錄  [📊 圖表] [💾 匯出]
```
- 即時顯示符合條件的記錄數量
- 方便了解資料規模

### 篩選區塊：
```
📋 支出記錄
[🔍 搜尋項目...] [全部分類▾] [全部付款人▾]
日期範圍：[開始日期] ～ [結束日期] [篩選] [清除]
```
- 所有篩選選項集中在一區
- 清晰易用

### 記錄列表改進：
```
🍜 晚餐                          $600  [刪除]
2024-01-15 · 飲食 · 兩人
(你: $300 / 對方: $300)
```
- 右側加入「刪除」按鈕
- 紅色醒目，避免誤觸

---

## 🆚 功能對比表

| 功能 | 優化前 | 優化後 |
|-----|--------|--------|
| **搜尋** | ❌ 無 | ✅ 即時搜尋 |
| **篩選** | ❌ 無 | ✅ 多維度篩選 |
| **刪除** | ⚠️ 只能在試算表手動刪 | ✅ 網頁一鍵刪除 |
| **圖表** | ❌ 無 | ✅ 長條圖視覺化 |
| **匯出** | ⚠️ 只能下載試算表 | ✅ CSV 一鍵匯出 |
| **記錄數量** | ❌ 不知道有幾筆 | ✅ 即時顯示 |
| **顯示筆數** | 固定 10 筆 | ✅ 顯示全部篩選結果 |

---

## 💡 使用技巧

### 技巧 1：快速查看特定月份
```
每個月 1 號：
1. 清除篩選
2. 設定上個月日期範圍
3. 點選「📊 圖表」
4. 點選「💾 匯出」備份
```

### 技巧 2：追蹤大額支出
```
在搜尋框輸入「房租」「保險」等關鍵字
→ 快速檢視固定大額支出
```

### 技巧 3：檢查分帳公平性
```
1. 點選「📊 圖表」
2. 查看「付款人統計」
3. 比較你和對方的長條圖長度
→ 一眼看出誰付得多
```

### 技巧 4：誤刪怎麼辦
```
⚠️ 刪除後無法復原！

預防方法：
1. 定期匯出備份（每月底）
2. 刪除前再次確認
3. 如果真的刪錯，可以從試算表的「版本記錄」還原
```

---

## 🎨 視覺改進

### 篩選區塊樣式：
```css
background: #f9fafb;
padding: 20px;
border-radius: 12px;
```
- 灰色背景區分區塊
- 圓角柔和設計

### 刪除按鈕樣式：
```css
background: #ef4444;  /* 紅色 */
hover: #dc2626;       /* 深紅色 */
transform: scale(1.05); /* 放大效果 */
```
- 紅色警示
- Hover 有放大效果

### 圖表 Modal：
```css
background: rgba(0, 0, 0, 0.7);  /* 半透明黑色背景 */
動畫：淡入 + 滑入
```
- 全螢幕半透明遮罩
- 白色卡片居中顯示
- 點擊外部可關閉

---

## 📈 效能優化

### 客戶端篩選：
```javascript
// 資料只載入一次
allExpenses = expenses;

// 篩選在瀏覽器端執行
filteredExpenses = allExpenses.filter(...);
```

**優點：**
- ✅ 篩選速度極快（毫秒級）
- ✅ 不用每次都從試算表讀取
- ✅ 減少 GAS 執行次數

---

## 🔧 技術實作

### 搜尋功能：
```javascript
document.getElementById('searchInput').addEventListener('input', function() {
  applyFilters(); // 即時觸發
});
```

### 篩選邏輯：
```javascript
filteredExpenses = allExpenses.filter(function(exp) {
  // 搜尋
  if (searchText && !exp.item.toLowerCase().includes(searchText)) {
    return false;
  }
  // 分類
  if (filterCategory && exp.category !== filterCategory) {
    return false;
  }
  // 日期
  if (startDate && exp.date < startDate) {
    return false;
  }
  return true;
});
```

### 刪除功能：
```javascript
// Code.gs
function deleteExpenseById(id) {
  const sheet = ...;
  const data = sheet.getDataRange().getValues();

  for (let i = 1; i < data.length; i++) {
    if (String(data[i][9]) === String(id)) {
      sheet.deleteRow(i + 1);
      return true;
    }
  }
}
```

### 匯出功能：
```javascript
const blob = new Blob(['\uFEFF' + csv], {
  type: 'text/csv;charset=utf-8;'
});
// \uFEFF 是 UTF-8 BOM，讓 Excel 正確識別中文
```

---

## ✅ 完整功能清單

### 現在你的記帳系統有：

#### 核心功能：
- ✅ 三種付款方式（單人、平分、自訂）
- ✅ 週期性支出自動記帳
- ✅ 自動結算換誰付款
- ✅ 五種分類管理

#### 新增功能：
- ✅ **即時搜尋**
- ✅ **多維度篩選**（分類+付款人+日期）
- ✅ **刪除記錄**
- ✅ **圖表視覺化**（長條圖）
- ✅ **匯出 CSV**

#### 使用者體驗：
- ✅ Toast 通知系統
- ✅ Loading 動畫
- ✅ 流暢的過渡動畫
- ✅ 響應式設計
- ✅ 鍵盤快捷鍵

---

## 🎯 總結

**現在你的記帳系統已經非常完整了！**

### 可以做到：
- ✅ 快速新增記錄
- ✅ 搜尋任何關鍵字
- ✅ 按條件篩選
- ✅ 刪除錯誤記錄
- ✅ 視覺化分析
- ✅ 匯出備份
- ✅ 手機電腦都能用

### 適合：
- 💑 情侶共同記帳
- 👨‍👩‍👧‍👦 家庭財務管理
- 🏠 室友分攤費用
- 👥 朋友出遊分帳

---

**祝你記帳愉快！** 💰✨
